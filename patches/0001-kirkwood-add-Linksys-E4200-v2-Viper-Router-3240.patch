From 7a5e752560bb035a6436b82b26892edfee795e8c Mon Sep 17 00:00:00 2001
From: darkdragon-001 <darkdragon-001@users.noreply.github.com>
Date: Tue, 9 Apr 2024 14:15:15 +0200
Subject: [PATCH 1/2] kirkwood: add Linksys E4200 v2 (Viper) Router (#3240)

---
 .github/filters.yml                                    | 10 ++++++++++
 .../luasrc/lib/gluon/upgrade/010-primary-mac           |  3 +++
 targets/kirkwood-generic                               |  5 +++++
 targets/targets.mk                                     |  1 +
 4 files changed, 19 insertions(+)
 create mode 100644 targets/kirkwood-generic

diff --git a/.github/filters.yml b/.github/filters.yml
index 2f634f35..41e4b5a2 100644
--- a/.github/filters.yml
+++ b/.github/filters.yml
@@ -292,6 +292,16 @@
     "targets/targets.mk",
     "targets/bcm27xx.inc"
   ],
+  "kirkwood-generic": [
+    "targets/kirkwood-generic",
+    ".github/workflows/build-gluon.yml",
+    "modules",
+    "Makefile",
+    "patches/**",
+    "scripts/**",
+    "targets/generic",
+    "targets/targets.mk"
+  ],
   "mvebu-cortexa9": [
     "targets/mvebu-cortexa9",
     ".github/workflows/build-gluon.yml",
diff --git a/package/gluon-core/luasrc/lib/gluon/upgrade/010-primary-mac b/package/gluon-core/luasrc/lib/gluon/upgrade/010-primary-mac
index fce501a6..a2946d9e 100755
--- a/package/gluon-core/luasrc/lib/gluon/upgrade/010-primary-mac
+++ b/package/gluon-core/luasrc/lib/gluon/upgrade/010-primary-mac
@@ -119,6 +119,9 @@ local primary_addrs = {
 			'openmesh,a42',
 			'openmesh,a62',
 		}},
+		{'kirkwood', 'generic', {
+			'linksys,e4200-v2',
+		}},
 		{'mpc85xx', 'p1020', {
 			'aerohive,hiveap-330',
 			'ocedo,panda',
diff --git a/targets/kirkwood-generic b/targets/kirkwood-generic
new file mode 100644
index 00000000..e36ae484
--- /dev/null
+++ b/targets/kirkwood-generic
@@ -0,0 +1,5 @@
+-- Linksys
+
+device('linksys-e4200-v2', 'linksys_e4200-v2', {
+	broken = true, -- 802.11s untested
+})
diff --git a/targets/targets.mk b/targets/targets.mk
index 14955134..20224a06 100644
--- a/targets/targets.mk
+++ b/targets/targets.mk
@@ -29,5 +29,6 @@ $(eval $(call GluonTarget,x86,64))
 ifeq ($(BROKEN),1)
 $(eval $(call GluonTarget,bcm27xx,bcm2710)) # BROKEN: Untested
 $(eval $(call GluonTarget,bcm27xx,bcm2711)) # BROKEN: No 11s support, no reset button, sys LED issues
+$(eval $(call GluonTarget,kirkwood,generic)) # BROKEN: 11s support untested
 $(eval $(call GluonTarget,mvebu,cortexa9)) # BROKEN: No 11s support
 endif
-- 
2.34.1

